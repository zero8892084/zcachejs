<!DOCTYPE html>
<html>
<head>
<title>test</title>
<meta charset="utf-8">
</head>
<body datascope="text">
	远程数据：
	<div id="J_data">
		&nbsp;
	</div>	
	<div>
		<button id="J_get">获取数据</button>
		<button id="J_update">更新缓存</button>
		<button id="J_del">删除缓存</button>
	</div>
	本地数据：
	<div id="J_data_local">
		&nbsp;
	</div>	
	<div>
		<button id="J_get_local">获取数据</button>
		<button id="J_update_local">设置数据</button>
		<button id="J_del_local">删除缓存</button>
	</div>
	<div>
		<button id="J_delete_all">清除所有缓存(已配置的)</button>
	</div>

	<div>
		<p>模块数据缓存</p>
		<textarea id="J_textarea" oninput="textareaInput(this)"></textarea>
		<button id="J_reload">刷新</button>
	</div>

	<div>
		<p>模块数据缓存---二级缓存</p>
		<div id="J_4"></div>
		<button id="J_1">设置值</button>
		<button id="J_2">获取值</button>
		<button id="J_3">提交缓存</button>
	</div>
</body>
<script src="../lib/jquery/1.8.2/jquery.min.js"></script>
<script src="../src/zcache.js"></script>
<script src="../src/ZModuleData.js"></script>
<script type="text/javascript">
	var cache=new ZCache({
		cache:{
			"testData":{
				key:"test",
				url:"data/test.json",
				maxAge:5*60*1000//缓存五分钟
			},
			"testLocal":{
				key:"local"
			}
		}
	});

	$('#J_get').on('click',function(){
		cache.get("testData",'',function(state,json){
			if(state=="success"){
				$('#J_data').html(JSON.stringify(json));
			}else{
				alert(state);
			}
		});
		/*
		在保证数据存在的情况下，也可以这样获取数据
		var data=cache.get("testData")
		$('#J_data').html(data);
		*/
	});
	$('#J_update').on('click',function(){
		cache.set("testData",'',function(state,json){
			if(state=="success"){
				$('#J_data').html(JSON.stringify(json));
			}else{
				alert(state);
			}
		});
	});
	$('#J_del').on('click',function(){
		cache.del('testData');
	});


	$('#J_get_local').on('click',function(){
		var data=cache.get("testLocal");
		$('#J_data_local').html(data);
	});
	$('#J_update_local').on('click',function(){
		cache.set("testLocal",'test');
	});
	$('#J_del_local').on('click',function(){
		cache.del('testLocal');
	});


	$('#J_delete_all').on('click',function(){
		cache.clearAll();
	});


	/*模块数据管理*/
	var md=new ZModuleData(cache,{
		key:'_ac',
		scope:['text','t2']
	});
	
	$('#J_textarea').val(md.get('val'));

	function textareaInput(obj){
		md.use('text');
		var val=$(obj).val();
		md.set('val',val);
	}	
	$('#J_reload').on('click',function(){
		window.location.reload();
	})
	/*模块数据管理--二级缓存*/
	$('#J_1').on('click',function(){
		md.use('t2');
		md.set({
			temp3:3
		});
		md.setTemp({
			temp1:1,
			temp2:2
		});
	});
	$('#J_2').on('click',function(){
		md.use('t2');
		var temp1=md.getTemp('temp1')+''+md.isTemp('temp1');
		var temp2=md.getTemp('temp2')+''+md.isTemp('temp2');
		var temp3=md.getTemp('temp3')+''+md.isTemp('temp3');
		$('#J_4').html(temp1+' '+temp2+' '+temp3+' <br/>'+JSON.stringify(md.getAllTemp()));
	});
	$('#J_3').on('click',function(){
		md.use('t2');
		md.commit();
	});
</script>
</html>